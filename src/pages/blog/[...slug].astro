---
// å¯¼å…¥ç±»å‹å’ŒAPIï¼Œç”¨äºè·å–åšå®¢å†…å®¹é›†åˆ
import { type CollectionEntry, getCollection } from 'astro:content';
// å¯¼å…¥å†…å®¹æ¸²æŸ“æ–¹æ³•ï¼Œç”¨äºæ¸²æŸ“ Markdown æ­£æ–‡
import { render } from 'astro:content';
// å¯¼å…¥ç»„ä»¶
import BaseLayout from '../../layouts/BaseLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';

// Astro çš„é™æ€è·¯å¾„ç”Ÿæˆå‡½æ•°ï¼Œå†³å®šå“ªäº›é¡µé¢ä¼šè¢«é¢„æ¸²æŸ“
export async function getStaticPaths() {
	// è·å–æ‰€æœ‰ blog collection ä¸‹çš„æ–‡ç« 
	const posts = await getCollection('blog');
	// ä¸ºæ¯ç¯‡æ–‡ç« ç”Ÿæˆä¸€ä¸ªé™æ€è·¯å¾„ï¼ˆslug ä½œä¸ºå‚æ•°ï¼‰
	return posts.map((post) => ({
		params: { slug: post.id }, // slug ç”¨äº URL åŒ¹é…ï¼Œå¦‚ /blog/hello-world/
		props: post, // ä¼ é€’æ–‡ç« å†…å®¹åˆ°é¡µé¢ props
	}));
}

// è·å– Astro è‡ªåŠ¨æ³¨å…¥çš„ propsï¼ˆå³å½“å‰æ–‡ç« çš„æ•°æ®ï¼‰
const post = Astro.props;
// æ¸²æŸ“å½“å‰æ–‡ç« çš„ Markdown æ­£æ–‡ï¼Œè¿”å› Content ç»„ä»¶
const { Content } = await render(post);
---

<BaseLayout title={post.data.title} description={post.data.description || ''}>
  <div class="p-6">
    <div class="bg-card rounded-xl overflow-hidden shadow-lg transition-colors duration-300">
      <!-- æ–‡ç« å¤´å›¾ -->
      {post.data.heroImage && (
        <div class="w-full h-60 md:h-80 overflow-hidden">
          <img 
            src={post.data.heroImage} 
            alt="" 
            class="w-full h-full object-cover" 
          />
        </div>
      )}
      
      <!-- æ–‡ç« å†…å®¹åŒº -->
      <div class="p-6 md:p-8">
        <!-- æ ‡é¢˜å’Œå…ƒæ•°æ® -->
        <div class="mb-6 pb-6 border-b border-border">
          <h1 class="text-2xl md:text-3xl font-bold mb-3">{post.data.title}</h1>
          <div class="flex flex-wrap gap-3 text-text-secondary text-sm">
            <span class="flex items-center gap-1">
              <span class="i-carbon-calendar"></span>
              <FormattedDate date={post.data.pubDate} />
            </span>
            {post.data.updatedDate && (
              <span class="flex items-center gap-1">
                <span class="i-carbon-edit"></span>
                æ›´æ–°äº <FormattedDate date={post.data.updatedDate} />
              </span>
            )}
          </div>
        </div>
        
        <!-- æ–‡ç« æ­£æ–‡ -->
        <article class="prose prose-invert prose-blue max-w-none">
          <Content />
        </article>
        
        <!-- æ–‡ç« åº•éƒ¨äº¤äº’åŒº -->
        <div class="mt-8 pt-6 border-t border-border flex justify-between items-center">
          <div class="flex gap-4 text-text-secondary">
            <button class="flex items-center gap-1 hover:text-accent transition-colors duration-200">
              <span>ğŸ‘</span> èµèµ
            </button>
            <button class="flex items-center gap-1 hover:text-accent transition-colors duration-200">
              <span>ğŸ’¬</span> è¯„è®º
            </button>
            <button class="flex items-center gap-1 hover:text-accent transition-colors duration-200">
              <span>ğŸ”</span> åˆ†äº«
            </button>
          </div>
          <a href="/blog" class="text-accent hover:underline">è¿”å›æ–‡ç« åˆ—è¡¨</a>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>
